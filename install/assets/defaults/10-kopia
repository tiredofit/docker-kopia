#!/command/with-contenv bash

BACKUP_PATH=${BACKUP_PATH:-"/backup/"}
CONFIG_PATH=${CONFIG_PATH:-"/config/"}
CONFIG_FILE=${CONFIG_FILE:-"repository.config"}
CACHE_PATH=${CACHE_PATH:-"/cache/"}
ENABLE_BENCHMARK=${ENABLE_BENCHMARK:-"FALSE"}
ENABLE_ACTIONS=${ENABLE_ACTIONS:-"TRUE"}
ENABLE_GUI=${ENABLE_GUI:-"TRUE"}
ENABLE_METRICS=${ENABLE_METRICS:-"TRUE"}
ENABLE_TLS=${ENABLE_TLS:-"TRUE"}
FINGERPRINT_CHECK_TIME_BEGIN=${FINGERPRINT_CHECK_TIME_BEGIN:-"+0"}
FINGERPRINT_CHECK_TIME_FREQ=${FINGERPRINT_CHECK_TIME_FREQ:-"10"}
FINGERPRINT_MODE=${FINGERPRINT_MODE:-"AUTO"}
KOPIA_HOSTNAME=${KOPIA_HOSTNAME:-"docker"}
KOPIA_LISTEN_PORT=${KOPIA_LISTEN_PORT:-"51115"}
KOPIA_USER=${KOPIA_USER:-"kopia@repohost"}
LOG_FILE=${LOG_FILE:-"kopia.log"}
LOG_LEVEL=${LOG_LEVEL:-"info"}
LOG_LEVEL_FILE=${LOG_LEVEL_FILE:-"debug"}
LOG_PATH=${LOG_PATH:-"/logs/"}
LOG_TYPE=${LOG_TYPE:-"BOTH"}
METRICS_LISTEN_PORT=${METRICS_LISTEN_PORT:-"6231"}
METRICS_TYPE=${METRICS_TYPE:-"LISTEN"}
PERSIST_CREDENTIALS=${PERSIST_CREDENTIALS:-"true"}
RCLONE_CONFIG_FILE=${RCLONE_CONFIG_FILE:-"${CONFIG_PATH}/rclone.conf"}
SETUP_TYPE=${SETUP_TYPE:-"AUTO"}
TLS_CERT_FILE=${TLS_CERT_FILE:-"/certs/cert.crt"}
TLS_DH_PARAM_FILE=${TLS_DH_PARAM_FILE:-"/certs/dhparam.pem"}
TLS_DH_PARAM_KEYSIZE=${TLS_DH_PARAM_KEYSIZE:-"1024"}
TLS_ENABLE_DH_PARAM=${TLS_ENABLE_DH_PARAM:-"FALSE"}
TLS_KEY_FILE=${TLS_KEY_FILE:-"/certs/cert.key"}
UI_SITE_TITLE_PREFIX=${UI_SITE_TITLE_PREFIX:-"Kopia Docker - "}
UI_ADMIN_USER=${UI_ADMIN_USER:-"kopia"}
UI_ADMIN_PASS=${UI_ADMIN_PASS:-"kopia"}

case "${MODE,,}" in
    repository)
        ENABLE_TLS=TRUE
    ;;
esac

if [ -n "${REPOSITORY_HOST}" ] ; then
    if [ "$(echo ${REPOSITORY_HOST} | cut -d : -f 3)" = "" ] ; then
        REPOSITORY_HOST="${REPOSITORY_HOST}:443"
    fi
fi

export TZ="${TIMEZONE}"